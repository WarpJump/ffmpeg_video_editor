# Видео Редактор v21 (Автономный)

Локальный веб-интерфейс для быстрой склейки и обработки видеолекций с помощью FFmpeg. Основная цель проекта — автоматизировать рутинные задачи видеомонтажа, сохраняя при этом максимальное качество за счет отказа от полного перекодирования видео.

## Зачем это нужно?

Обработка записей лекций или вебинаров часто включает в себя повторяющиеся действия:
*   Вырезать ненужные части в начале и в конце.
*   Склеить два видеофрагмента (например, до и после перерыва).
*   Добавить стандартную заставку (интро).
*   Заменить оригинальную аудиодорожку на улучшенную.
*   Обеспечить плавные переходы между всеми частями.

Выполнение этих операций в традиционных видеоредакторах требует времени и, что самое важное, приводит к полному перекодированию (рендеру) всего видео, что занимает много времени и потенциально снижает качество.

Этот инструмент решает проблему, используя "умный" подход с FFmpeg, при котором **перекодируются только микроскопические участки переходов**, а основные части видео склеиваются без потерь (`-c:v copy`).

## Ключевые возможности

*   **Веб-интерфейс:** Удобное управление через браузер. Сервер запускается локально, интернет не требуется.
*   **Склейка без потерь:** Основные видеопотоки не перекодируются, что обеспечивает максимальную скорость и сохранение исходного качества.
*   **Плавные переходы:** Автоматическое создание плавных затемнений (fade-in/fade-out) для видео и звука на всех стыках.
*   **Гибкие режимы работы:** Поддержка обработки как одного, так и двух исходных видеофайлов.
*   **Замена аудио:** Возможность использовать отдельные, заранее обработанные аудиофайлы для каждого сегмента.
*   **Поддержка RAM-диска:** Использование ОЗУ для временных файлов на Linux для максимального ускорения.
*   **Кастомизация интро:** Поддержка заставок в разных разрешениях (FullHD, 2K).

## Требования и установка

1.  **Python 3:** Убедитесь, что Python установлен в вашей системе.
2.  **FFmpeg:** Утилита `ffmpeg` должна быть установлена и доступна в системной переменной `PATH`.
3.  **Python-библиотеки:** Установите необходимые зависимости:
    ```bash
    pip install websockets tkinter
    ```

## Структура файлов

```
.
├── lecture-editor/      # Основная папка проекта
│   ├── gui2.py          # Главный скрипт: веб-сервер и логика FFmpeg
│   └── file_picker.py   # Вспомогательный скрипт для вызова диалога выбора файла
│
└── intro_new_sponsored_2k.mkv       # Файл с интро в разрешении 2K (должен лежать НА УРОВЕНЬ ВЫШЕ)
└── intro_new_sponsored_fullhd.mkv # Файл с интро в разрешении FullHD (должен лежать НА УРОВЕНЬ ВЫШЕ)
```

**Важно:** Файлы с интро должны находиться в директории, родительской по отношению к той, где лежит `gui2.py`.

## Как использовать

1.  Убедитесь, что выполнены все требования и файлы интро расположены правильно.
2.  Запустите главный скрипт из терминала:
    ```bash
    python gui2.py
    ```
3.  В вашем браузере автоматически откроется страница `http://127.0.0.1:8765`.
4.  Настройте параметры в веб-интерфейсе, выберите файлы и нажмите "Начать Обработку".
5.  Следите за прогрессом в окне "Лог выполнения".
6.  По завершении итоговый файл будет сохранен в той же директории, где находился "Видео 1".

---

## Подробное описание режимов и опций

### 1. Настройки

#### Режим Работы

*   **Один файл:** Этот режим предназначен для случаев, когда вся лекция записана в одном большом видеофайле.
    *   **Если НЕ отмечен чекбокс "Обработать как единый ролик":** Скрипт вырежет два сегмента из этого одного файла (например, часть до перерыва и часть после) и склеит их. Интерфейс скроет поля "Выбрать Видео 2" и "Аудио 2", так как источник для второго сегмента будет тот же, что и для первого. Поля для таймкодов второго сегмента останутся видимыми.
    *   **Если отмечен чекбокс "Обработать как единый ролик":** Скрипт вырежет только один непрерывный кусок видео. Интерфейс скроет все поля, относящиеся ко второму сегменту ("Видео 2", "Аудио 2" и "Таймкоды Сегмент 2").

*   **Два файла:** Используйте этот режим, если лекция уже состоит из двух отдельных видеофайлов (`part1.mkv`, `part2.mkv`). В этом режиме все поля для выбора файлов и таймкодов видимы.

#### Другие опции

*   **Использовать RAM-диск:** (Только для Linux) Если опция активна, все временные файлы (короткие переходы) будут создаваться в `/dev/shm`, то есть в оперативной памяти. Это значительно ускоряет обработку, но требует достаточного количества свободной ОЗУ.
*   **Разрешение интро:** Позволяет выбрать, какую версию интро-заставки использовать — `fullhd` (1920x1080) или `2k` (2560x1440). Выбор также влияет на префикс имени выходного файла (`fullhd_...` или `2k_...`).

### 2. Файлы

*   **Видео 1 / Видео 2:** Основные видеофайлы для обработки.
*   **Аудио 1 / Аудио 2 (опция):** Позволяют заменить оригинальную звуковую дорожку из видео на звук из другого файла. Это полезно, если вы обработали и улучшили звук отдельно. Если поле оставить пустым, будет использоваться звук из соответствующего видеофайла.

### 3. Таймкоды

Здесь указываются временные метки для вырезания нужных фрагментов. Формат гибкий: `ЧЧ:ММ:СС`, `ММ:СС` или просто секунды.

## Как это работает (Технические детали)

*   **Гибридная архитектура:** Скрипт использует `asyncio` и `websockets` для создания легковесного асинхронного сервера. Для вызова нативного системного диалога выбора файла используется `tkinter`, который запускается в **отдельном процессе**, чтобы не блокировать основной асинхронный цикл сервера.
*   **Эффективная работа с FFmpeg:**
    1.  Для каждого сегмента вычисляются ближайшие ключевые кадры (I-frames) к точкам обрезки.
    2.  Создаются очень короткие (1-2 секунды) перекодированные видеоклипы с эффектами fade-in/fade-out.
    3.  Основная, длинная часть видео между точками обрезки **не трогается**.
    4.  С помощью `concat` демультиплексора FFmpeg собирает финальное видео: `интро` + `fade-in 1` + `основная часть 1` + `fade-out 1` + `fade-in 2` + `основная часть 2` + `fade-out 2`.
    5.  Аудиодорожки обрабатываются отдельно с помощью `filter_complex` для создания бесшовной звуковой картины с плавными переходами.